#include "sysUtils.h"
#include "utils.h"
#include "chip.h"
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>

uint8_t flag_entrada=0;
uint8_t * dat;

void GPIO1_IRQHandler(void)
{
	/*limpiar el estado de la interrupciÃ³n*/
	Chip_PININT_ClearIntStatus (LPC_GPIO_PIN_INT , PININTCH (TEC1_IRQ));
	delayMs(300);

}


void UART2_IRQHandler(void)
{

	Chip_UART_IRQRBHandler(LPC_USART2, &rxRing, &txRing);
	flag_entrada=1;
}


int main (void)
{
	inicializar_sistema();
	inicializar_leds();
	inicializar_teclado();
	init_interrupciones();
	inicializar_USART();

	uint8_t bytes =0;

	while (1)
	{


		__WFI();
		if(flag_entrada)
		{
			bytes = serialRead(&dat, 1);
			if(bytes > 0)
			{
				if(key == 13)
				{
				  print("\n\r");
				}
				else
				{
				  print((const char*) &dat);
				}

		    }

			if( (i >=250) || (dat == '\r') )
			{
				i = 0;
				flag_entrada=0;
				conversion_morse(inBuff);
			}
		}

	}


	return 0;
}

